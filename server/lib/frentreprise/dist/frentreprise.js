!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("frentreprise",[],t):"object"==typeof exports?exports.frentreprise=t():e.frentreprise=t()}(global,function(){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:n})},r.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r.w={},r(r.s=11)}([function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e};const o=Symbol("_importData"),a=Symbol("_data");t.default=class{constructor(e){this[o](e,!0)}updateData(e){this[o](e)}replaceData(e){this[o](e,!0)}[o](e,t=!1){"object"==typeof e&&(this[a]=n({},!0===t?{}:this[a],e)),Object.keys(this[a]).forEach(e=>{this.hasOwnProperty(e)||Object.defineProperty(this,e,{get:()=>this[a][e]})},this)}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,o=r(0),a=(n=o)&&n.__esModule?n:{default:n};t.default=class extends a.default{}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,o=r(0),a=(n=o)&&n.__esModule?n:{default:n};const i=Symbol("_ets");t.default=class extends a.default{constructor(e){super(e),this[i]=[]}get etablissements(){return[...this[i]]}importEtablissement(e){this[i].push(e)}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Etablissement=t.Entreprise=void 0;var n=r(2);Object.defineProperty(t,"Entreprise",{enumerable:!0,get:function(){return i(n).default}});var o=r(1);Object.defineProperty(t,"Etablissement",{enumerable:!0,get:function(){return i(o).default}});var a=i(n);function i(e){return e&&e.__esModule?e:{default:e}}t.default=a.default},function(e,t,r){"use strict";function n(e){const t=(new Error).stack.split("\n")[2].replace(" at ","");this.message=`The method ${t} isn't implemented.`,e&&(this.message+=` Message: "${e}".`);let r=this.message;for(;r.indexOf("  ")>-1;)r=r.replace("  "," ");this.message=r}Object.defineProperty(t,"__esModule",{value:!0}),n.prototype=Object.create(Error.prototype,{constructor:{value:n},name:{value:"NotImplementedError"},stack:{get:function(){return(new Error).stack}}}),t.default=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,o=r(4),a=(n=o)&&n.__esModule?n:{default:n};function i(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){return function n(o,a){try{var i=t[o](a),s=i.value}catch(e){return void r(e)}if(!i.done)return Promise.resolve(s).then(function(e){n("next",e)},function(e){n("throw",e)});e(s)}("next")})}}t.default=class{getSIRET(){return i(function*(){throw new a.default})()}getSIREN(){return i(function*(){throw new a.default})()}search(){return i(function*(){throw new a.default})()}}},function(e,t){e.exports=require("axios")},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=a(r(6)),o=a(r(5));function a(e){return e&&e.__esModule?e:{default:e}}function i(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){return function n(o,a){try{var i=t[o](a),s=i.value}catch(e){return void r(e)}if(!i.done)return Promise.resolve(s).then(function(e){n("next",e)},function(e){n("throw",e)});e(s)}("next")})}}const s=e=>({token:e.token,context:"Tiers",recipient:"Direccte Occitanie",object:"FCEE - Direccte Occitanie"}),u=Symbol("_convertDate");t.default=class extends o.default{constructor(e){super(),this.token=null,this.axios=n.default.create({baseURL:e,timeout:3e4})}getSIRET(e){var t=this;return i(function*(){const r=yield t.axios.get(`etablissements_legacy/${e}`,{params:s(t)});return r&&"object"==typeof r&&r.data&&"object"==typeof r.data&&r.data.etablissement||{}})()}getSIREN(e){var t=this;return i(function*(){let r=null;try{r=yield t.axios.get(`entreprises_legacy/${e}`,{params:s(t)})}catch(e){console.log(e)}const n={};if(r&&"object"==typeof r&&r.data&&"object"==typeof r.data&&r.data.entreprise){const e=r.data.entreprise;["siret","raison_sociale","categorie_entreprise"].forEach(function(t){n[t]=e[t]}),n.categorie_juridique=e.forme_juridique,n.date_de_creation=t[u](e.date_creation),n.date_de_radiation=t[u](e.date_radiation),e.etat_administratif&&"object"==typeof e.etat_administratif||(e.etat_administratif={}),n.etat_entreprise={label:e.etat_administratif.value||"N/A",date:t[u](e.etat_administratif.date_mise_a_jour)}}let o=null;try{o=yield t.axios.get(`entreprises/${e}`,{params:s(t)})}catch(e){console.log(e)}if(o&&"object"==typeof o&&o.data&&"object"==typeof o.data&&o.data.entreprise){const e=o.data.entreprise;["categorie_entreprise"].forEach(function(t){n[t]=e[t]})}return n})()}[u](e){return e&&new Date(1e3*e)||null}search(){return i(function*(){return!1})()}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.validateSIREN=function(e){if(!/^[0-9]{9}$/.test(e))return!1;return e.split("").reduce((e,t,r)=>{t=+t;const n=r%2==0;return n?e+t:e+((t*=2)>9?t-9:t)},0)%10==0},t.validateSIRET=function(e){if(!/^[0-9]{14}$/.test(e))return!1;return e.split("").reduce((e,t,r)=>{t=+t;const n=r%2!=0;return n?e+t:e+((t*=2)>9?t-9:t)},0)%10==0}},function(e,t,r){"use strict";function n(e){this.message=`Invalid SIRET or SIREN. ${e}`}Object.defineProperty(t,"__esModule",{value:!0}),n.prototype=Object.create(Error.prototype,{constructor:{value:n},name:{value:"InvalidIdentifierError"},stack:{get:function(){return(new Error).stack}}}),t.default=n},function(e,t,r){"use strict";var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},o=u(r(9)),a=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(r(8)),i=u(r(7)),s=u(r(3));function u(e){return e&&e.__esModule?e:{default:e}}e.exports=new class{constructor(){this.EntrepriseModel=s.default,this.EtablissementModel=s.default,this.dataSources=[],this.addDataSource({name:"ApiGouv",priority:100,source:new i.default("https://entreprise.api.gouv.fr/v2/")})}getEntreprise(e){var t,r=this;return(t=function*(){e+="";const t=a.validateSIREN(e),i=a.validateSIRET(e);if(!t&&!i)throw new o.default(e);const s=t?e:e.substr(0,9);r.getDataSources();let u={};for(let e=0;e<r.dataSources.length;e++){const t=r.dataSources[e].source;u=n({},u,yield t.getSIREN(s))}const c=new r.EntrepriseModel(u);if(i){let t={};for(let o=0;o<r.dataSources.length;o++){const a=r.dataSources[o].source;t=n({},t,yield a.getSIRET(e))}c.importEtablissement(new r.EtablissementModel(t))}return c},function(){var e=t.apply(this,arguments);return new Promise(function(t,r){return function n(o,a){try{var i=e[o](a),s=i.value}catch(e){return void r(e)}if(!i.done)return Promise.resolve(s).then(function(e){n("next",e)},function(e){n("throw",e)});t(s)}("next")})})()}search(){return[]}getDataSources(){return[...this.dataSources].sort((e,t)=>(e=+(e&&e.priority))>(t=+(t&&t.priority))?1:e<t?-1:0)}getDataSource(e){return this.dataSources.find(t=>t.name===e)}addDataSource(e){this.dataSources.includes(e)||this.dataSources.push(e)}removeDataSource(e){this.dataSources.slice(this.dataSources.indexOf(e),1)}},e.exports.Entreprise=s.default,e.exports.Etablissement=s.default,e.exports.isSIRET=a.validateSIRET,e.exports.isSIREN=a.validateSIREN},function(e,t,r){e.exports=r(10)}])});