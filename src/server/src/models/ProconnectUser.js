const Domains = [
  "deets.gouv.fr",
  "dgccrf.finances.gouv.fr",
  "dreets.gouv.fr",
  "drieets.gouv.fr",
  "emploi.gouv.fr",
  "finances.gouv.fr",
  "sg.social.gouv.fr",
  "travail.gouv.fr",
];
const AllowedSirets = [
    "13000898000026",
  "13002897000015",
  "13000920200016",
  "13002898800017",
  "13002899600010",
  "13002900200016",
  "13002901000019",
  "13001121600020",
  "13002902800011",
  "13002903600014",
  "13002904400018",
  "13002905100013",
  "13002906900015",
  "13002907700018",
  "13002876400012",
  "13001151300012",
  "13002878000018",
  "13001160400019",
  "13002879800010",
  "13002880600011",
  "13002881400015",
  "13000983000022",
  "13002883000011",
  "13002884800021",
  "13002886300012",
  "13000942600029",
  "13002888900017",
  "13000945900012",
  "13002890500011",
  "13002891300015",
  "13002819400012",
  "13002820200021",
  "13000986300023",
  "13002821000016",
  "13000894900021",
  "13002822800018",
  "13002823600011",
  "13000933500022",
  "13002824400015",
  "13002870700011",
  "13002871500014",
  "13001023400016",
  "13002825100010",
  "13000935000021",
  "13002826900020",
  "13002827700015",
  "13000975600011",
  "13002831900023",
  "13000851900022",
  "13002832700018",
  "13002843400012",
  "13002935800012",
  "13002847500015",
  "13000941800026",
  "13002854100014",
  "13000816200021",
  "13002857400023",
  "13002858200018",
  "13002859000011",
  "13002860800011",
  "13002860800029",
  "13001043200024",
  "13002861600014",
  "13002862400018",
  "13001031700027",
  "13002863200029",
  "13001112500015",
  "13002864000014",
  "13002833500011",
  "13002836800012",
  "13002838400019",
  "13001065500012",
  "13002841800015",
  "13001076200024",
  "13002844200015",
  "13002846700012",
  "13002848300019",
  "13002849100012",
  "13000949100031",
  "13002852500017",
  "13002853300029",
  "13000829500029",
  "13002855800026",
  "13000923600022",
  "13002856600029",
  "13002828500026",
  "13000904600025",
  "13002829300038",
  "13002829300046",
  "13002829300053",
  "13002829300061",
  "13002829300079",
  "13002829300087",
  "13002829300095",
  "13000931900018",
  "13002830100013",
  "13002834300015",
  "13000921000019",
  "13002835000010",
  "13000827900031",
  "13002837600015",
  "13001072100020",
  "13001072100038",
  "13002839200012",
  "13002840000013",
  "13000907900018",
  "13002842600018",
  "13001037400028",
  "13002845900019",
  "13002850900011",
  "13000917800026",
  "13002851700022",
  "13002873100011",
  "13000887300015",
  "13002874900013",
  "13000990500030",
  "13002875600018",
  "13002877200015",
  "13000932700011",
  "13002882200018",
  "13001213100012",
  "13001060600015",
  "13001060600031",
  "13001060600049",
  "13001060600064",
  "13002885500026",
  "13001209900011",
  "13002887100015",
  "13001219800037",
  "13002889700028",
  "13002892100018",
  "13000966500030",
  "13002893900010",
  "13002894700013",
  "13002895400019",
  "13001007700027",
  "13002814500014",
  "13000905300013",
  "13002815200010",
  "13000938400020",
  "13002816000021",
  "13001066300024",
  "13002817800015",
  "13002818600018",
  "13002865700018",
  "13002866500011",
  "13002867300015",
  "13001245300036",
  "13002868100018",
  "13002868100026",
  "13001205700019",
  "13001208100019",
  "13001224800014",
  "13001224800022",
  "13001206500020",
  "13002869900010",
  "13002933300015",
  "13002933300023",
  "13002933300049",
  "13002933300056",
  "13002933300064",
  "13002933300072",
  "13002933300080",
  "13002918400012",
  "13002918400020",
  "13002920000016",
  "13002920000024",
  "13002920000032",
  "13002920000040",
  "13002920000057",
  "13002922600011",
  "13002922600029",
  "13002933300031",
];
export const isValidSiret = (siret) => {
  if (typeof siret !== "string") return false;

  const cleanedSiret = siret.replace(/\s+/g, "");

  if (!/^\d{14}$/.test(cleanedSiret)) return false;

  try {
    return AllowedSirets.includes(cleanedSiret);
  } catch {
    return false;
  }
};
export const isValidDomain = (email) => {
  try {
    const domain = extractDomain(email);
    return Domains.some((d) => domain.includes(d));
  } catch {
    return false;
  }
};
export const extractDomain = (email) => {
  try {
    return (email.match(/@(.*)/) || [""]).shift() || "";
  } catch {
    return "";
  }
};
export function isAuthorizedUser(user) {
  // Vérif domaine e-mail
  const domain = extractDomain(user.email);
  if (domain && isValidDomain(domain)) {
    console.log(`Domaine autorisé: ${domain}`);
    return true;
  }

  //  Vérif SIRET
  if (user?.siret && isValidSiret(user.siret)) {
    console.log(`SIRET autorisé: ${user.siret}`);
    return true;
  }

  // Refus par défaut
  return false;
}
